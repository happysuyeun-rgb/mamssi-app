# 감정 기록 이미지 업로드 기능 테스트

## 테스트 일시
- 시작: [날짜/시간]
- 종료: [날짜/시간]

## 테스트 환경
- 브라우저: Chrome/Edge
- 개발 서버: `http://localhost:5173`
- 데이터베이스: Supabase
- Storage 버킷: `emotion-images`

---

## 사전 준비

### 1. Storage 버킷 생성 확인
- [ ] Supabase Dashboard > Storage에서 `emotion-images` 버킷 존재 확인
- [ ] 버킷이 없으면 `create_emotion_images_bucket.sql` 실행
- [ ] 버킷 설정 확인:
  - Public: ON
  - File size limit: 10485760 (10MB)
  - Allowed MIME types: image/jpeg, image/jpg, image/png, image/webp, image/gif

### 2. RLS 정책 확인
- [ ] SELECT 정책: 모든 사용자 조회 가능
- [ ] INSERT 정책: 본인만 업로드 가능
- [ ] UPDATE 정책: 본인만 수정 가능
- [ ] DELETE 정책: 본인만 삭제 가능

---

## 테스트 시나리오

### 시나리오 1: 새 감정 기록에 이미지 업로드

#### 전제 조건
- 로그인 상태
- 기록 화면 접속 (`/record`)

#### 테스트 단계
1. [ ] 감정 선택 (예: 기쁨 😊)
2. [ ] 내용 입력 (예: "오늘 날씨가 좋아서 기분이 좋아요")
3. [ ] "사진 첨부" 버튼 클릭
4. [ ] 이미지 파일 선택 (JPG, 5MB 이하)
5. [ ] 이미지 미리보기 표시 확인
6. [ ] 공개 설정 선택 (선택사항)
7. [ ] "저장" 버튼 클릭
8. [ ] 업로드 진행 상태 확인 (로딩 표시)
9. [ ] 콘솔에서 `[uploadEmotionImage] 파일 업로드 성공` 로그 확인
10. [ ] Supabase Dashboard > Storage > `emotion-images`에서 파일 확인
11. [ ] Supabase Dashboard > `emotions` 테이블에서 `image_url` 필드 확인
12. [ ] 성공 토스트 메시지 확인
13. [ ] 홈 화면으로 리다이렉트 확인

#### 예상 결과
- ✅ 이미지가 Storage에 저장됨
- ✅ `emotions.image_url`에 Public URL이 저장됨
- ✅ 홈 화면으로 이동
- ✅ 성공 메시지 표시

---

### 시나리오 2: 이미지 개수 제한 ⭐ 신규 기능

#### 테스트 케이스 2-1: 이미지 0개 → 1개 추가
1. [ ] 기록 화면에서 "📷 사진 추가" 버튼 클릭
2. [ ] 이미지 파일 1개 선택
3. [ ] 이미지 미리보기 1개 표시 확인
4. [ ] 추가 성공 확인

#### 테스트 케이스 2-2: 이미지 1개 → 2개 추가
1. [ ] 이미지 1개가 있는 상태에서 "📷 사진 추가" 버튼 클릭
2. [ ] 이미지 파일 1개 선택
3. [ ] 이미지 미리보기 2개 표시 확인
4. [ ] 추가 성공 확인

#### 테스트 케이스 2-3: 이미지 2개 → 추가 불가
1. [ ] 이미지 2개가 있는 상태에서 "📷 사진 추가" 버튼 클릭
2. [ ] 이미지 파일 선택 시도
3. [ ] 경고 메시지 확인: "이미지는 최대 2개까지 첨부할 수 있어요 ⚠️"
4. [ ] 이미지가 추가되지 않음 확인 (여전히 2개)

#### 테스트 케이스 2-4: 이미지 삭제 후 다시 추가
1. [ ] 이미지 2개가 있는 상태
2. [ ] 이미지 1개 삭제 (X 버튼 클릭)
3. [ ] 이미지 미리보기 1개로 감소 확인
4. [ ] "📷 사진 추가" 버튼 클릭
5. [ ] 이미지 파일 1개 선택
6. [ ] 이미지 미리보기 2개로 증가 확인
7. [ ] 추가 성공 확인

#### 테스트 케이스 2-5: 여러 파일 선택 시 슬롯 제한
1. [ ] 이미지 1개가 있는 상태
2. [ ] "📷 사진 추가" 버튼 클릭
3. [ ] 이미지 파일 3개 동시 선택
4. [ ] 이미지 미리보기 2개만 표시 확인 (1개 추가됨)
5. [ ] 경고 메시지 확인: "이미지는 최대 2개까지 첨부할 수 있어요. 1개만 추가되었어요. ⚠️"

**예상 결과**: 이미지 개수 제한 정상 동작

---

### 시나리오 3: 이미지 유효성 검사

#### 테스트 케이스 3-1: 파일 크기 초과
1. [ ] 기록 화면에서 "사진 첨부" 버튼 클릭
2. [ ] 10MB 초과 이미지 파일 선택
3. [ ] 경고 메시지 확인: "10MB 이하의 이미지만 첨부할 수 있어요 ⚠️"
4. [ ] 업로드가 진행되지 않음 확인

#### 테스트 케이스 2-2: 이미지가 아닌 파일
1. [ ] 기록 화면에서 "사진 첨부" 버튼 클릭
2. [ ] 텍스트 파일(.txt) 선택
3. [ ] 경고 메시지 확인
4. [ ] 업로드가 진행되지 않음 확인

#### 테스트 케이스 2-3: 정상 이미지
1. [ ] 기록 화면에서 "사진 첨부" 버튼 클릭
2. [ ] 정상 이미지 파일 선택 (JPG, 5MB 이하)
3. [ ] 이미지 미리보기 표시 확인
4. [ ] 업로드 성공 확인

---

### 시나리오 4: 기존 기록 이미지 수정

#### 전제 조건
- 이미지가 있는 기존 감정 기록 존재

#### 테스트 단계
1. [ ] 홈 화면에서 기존 기록 날짜 클릭
2. [ ] 기록 수정 화면 진입
3. [ ] 기존 이미지 미리보기 표시 확인
4. [ ] "사진 첨부" 버튼 클릭
5. [ ] 새 이미지 파일 선택
6. [ ] 새 이미지 미리보기 표시 확인
7. [ ] "수정 완료" 버튼 클릭
8. [ ] 콘솔에서 기존 이미지 삭제 로그 확인
9. [ ] Supabase Dashboard > Storage에서 기존 이미지 삭제 확인
10. [ ] 새 이미지 업로드 확인
11. [ ] `emotions.image_url` 업데이트 확인

#### 예상 결과
- ✅ 기존 이미지가 Storage에서 삭제됨
- ✅ 새 이미지가 업로드됨
- ✅ `emotions.image_url`이 새 URL로 업데이트됨

---

### 시나리오 5: 기록 이미지 삭제

#### 전제 조건
- 이미지가 있는 기존 감정 기록 존재

#### 테스트 단계
1. [ ] 홈 화면에서 기존 기록 날짜 클릭
2. [ ] 기록 수정 화면 진입
3. [ ] 기존 이미지 미리보기 표시 확인
4. [ ] 이미지 미리보기에서 X 버튼 클릭
5. [ ] 이미지 미리보기 제거 확인
6. [ ] "수정 완료" 버튼 클릭
7. [ ] `emotions.image_url = null` 확인 (Supabase Dashboard에서 확인)
8. [ ] Storage에서 이미지 삭제 확인 (선택사항)

#### 예상 결과
- ✅ 이미지 미리보기가 제거됨
- ✅ `emotions.image_url`이 null로 업데이트됨

---

### 시나리오 6: 에러 처리

#### 테스트 케이스 5-1: 버킷이 없을 때
1. [ ] `emotion-images` 버킷 삭제 (또는 존재하지 않는 상태)
2. [ ] 기록 화면에서 이미지 업로드 시도
3. [ ] 에러 메시지 확인: "Storage 버킷 'emotion-images'이 존재하지 않거나 접근할 수 없어요..."
4. [ ] 명확한 해결 방법 안내 확인

#### 테스트 케이스 5-2: 네트워크 에러
1. [ ] 네트워크 연결 끊기 (개발자 도구 > Network > Offline)
2. [ ] 기록 화면에서 이미지 업로드 시도
3. [ ] 에러 메시지 표시 확인
4. [ ] 재시도 옵션 확인

#### 테스트 케이스 5-3: 권한 에러
1. [ ] 로그아웃 상태 (또는 권한 없는 사용자)
2. [ ] 기록 화면에서 이미지 업로드 시도
3. [ ] 권한 에러 메시지 확인: "이미지 업로드 권한이 없어요. 로그인 상태를 확인해주세요."

---

## 테스트 결과

### 통과한 테스트
- [ ] 시나리오 1: 새 감정 기록에 이미지 업로드
- [ ] 시나리오 2-1: 이미지 0개 → 1개 추가
- [ ] 시나리오 2-2: 이미지 1개 → 2개 추가
- [ ] 시나리오 2-3: 이미지 2개 → 추가 불가
- [ ] 시나리오 2-4: 이미지 삭제 후 다시 추가
- [ ] 시나리오 2-5: 여러 파일 선택 시 슬롯 제한
- [ ] 시나리오 3-1: 파일 크기 초과 검사
- [ ] 시나리오 3-2: 이미지가 아닌 파일 검사
- [ ] 시나리오 3-3: 정상 이미지 업로드
- [ ] 시나리오 4: 기존 기록 이미지 수정
- [ ] 시나리오 5: 기록 이미지 삭제
- [ ] 시나리오 6-1: 버킷 없음 에러 처리
- [ ] 시나리오 6-2: 네트워크 에러 처리
- [ ] 시나리오 6-3: 권한 에러 처리

### 실패한 테스트
- [ ] [테스트 항목] - [실패 이유]

### 발견된 이슈
1. [이슈 설명]
   - 재현 단계:
   - 예상 결과:
   - 실제 결과:
   - 스크린샷:

---

## 체크리스트

### 필수 확인 사항
- [ ] Storage 버킷 `emotion-images` 존재
- [ ] RLS 정책 정상 설정
- [ ] 이미지 업로드 성공
- [ ] 이미지 URL이 DB에 저장됨
- [ ] 이미지 미리보기 정상 표시
- [ ] 이미지 삭제 정상 동작
- [ ] 에러 메시지 명확함

### 선택 확인 사항
- [ ] 여러 이미지 업로드 (현재는 1개만 지원)
- [ ] 이미지 압축 (자동 리사이징)
- [ ] 업로드 진행률 표시

---

## 다음 단계

1. [ ] 발견된 이슈 수정
2. [ ] 재테스트 진행
3. [ ] 프로덕션 배포 준비
